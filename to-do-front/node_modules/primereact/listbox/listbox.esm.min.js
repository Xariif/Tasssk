import*as e from"react";import{FilterService as t}from"primereact/api";import{useMountEffect as r}from"primereact/hooks";import{Tooltip as n}from"primereact/tooltip";import{ObjectUtils as l,classNames as a,DomHandler as o}from"primereact/utils";import{VirtualScroller as i}from"primereact/virtualscroller";import{InputText as u}from"primereact/inputtext";import{Ripple as c}from"primereact/ripple";function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e){if(Array.isArray(e))return f(e)}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function b(e,t){if(e){if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(e,t):void 0}}function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e){return m(e)||d(e)||b(e)||v()}function h(e){if(Array.isArray(e))return e}function g(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,l,a=[],o=!0,i=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){i=!0,l=e}finally{try{o||null==r.return||r.return()}finally{if(i)throw l}}return a}}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var x=e.memo((function(t){var r={filter:function(e){return n(e)},reset:function(){return t.resetFilter()}},n=function(e){t.onFilter&&t.onFilter({originalEvent:e,value:e.target.value})},a=function(){var a=e.createElement("div",{className:"p-listbox-filter-container"},e.createElement(u,s({type:"text",value:t.filter,onChange:n,className:"p-listbox-filter",disabled:t.disabled,placeholder:t.filterPlaceholder},t.filterInputProps)),e.createElement("span",{className:"p-listbox-filter-icon pi pi-search"}));t.filterTemplate&&(a=l.getJSXElement(t.filterTemplate,{className:"p-listbox-filter-container",element:a,filterOptions:r,filterInputChange:n,filterIconClassName:"p-dropdown-filter-icon pi pi-search",props:t}));return e.createElement("div",{className:"p-listbox-header"},a)}();return e.createElement(e.Fragment,null,a)}));x.displayName="ListBoxHeader";var O=e.memo((function(t){var r=function(e){t.onClick&&t.onClick({originalEvent:e,option:t.option}),e.preventDefault()},n=function e(t){var r=t.nextElementSibling;return r?o.hasClass(r,"p-disabled")||o.hasClass(r,"p-listbox-item-group")?e(r):r:null},i=function e(t){var r=t.previousElementSibling;return r?o.hasClass(r,"p-disabled")||o.hasClass(r,"p-listbox-item-group")?e(r):r:null},u=a("p-listbox-item",{"p-highlight":t.selected,"p-disabled":t.disabled},t.option.className),s=t.template?l.getJSXElement(t.template,t.option):t.label;return e.createElement("li",{className:u,style:t.style,onClick:r,onTouchEnd:function(e){t.onTouchEnd&&t.onTouchEnd({originalEvent:e,option:t.option})},onKeyDown:function(e){var t=e.currentTarget;switch(e.which){case 40:var l=n(t);l&&l.focus(),e.preventDefault();break;case 38:var a=i(t);a&&a.focus(),e.preventDefault();break;case 13:r(e),e.preventDefault()}},tabIndex:"-1","aria-label":t.label,key:t.label,role:"option","aria-selected":t.selected,"aria-disabled":t.disabled},s,e.createElement(c,null))}));function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function w(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=T(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,l=function(){};return{s:l,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw a}}}}function T(e,t){if(e){if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}O.displayName="ListBoxItem";var D=e.memo(e.forwardRef((function(o,u){var c,p,f=e.useState(""),m=(p=2,h(c=f)||g(c,p)||b(c,p)||E()),d=m[0],v=m[1],S=e.useRef(null),T=e.useRef(null),I=e.useRef(!1),L=(o.onFilterValueChange?o.filterValue:d)||"",P=L&&L.trim().length>0,F=function(e){var t=e.option;o.disabled||X(t)||(o.multiple?A(e.originalEvent,t):j(e.originalEvent,t),I.current=!1)},N=function(){o.disabled||(I.current=!0)},j=function(e,t){var r=_(t),n=!1,l=null;!I.current&&o.metaKeySelection?r?(e.metaKey||e.ctrlKey)&&(l=null,n=!0):(l=z(t),n=!0):(l=r?null:z(t),n=!0);n&&G(e,l)},A=function(e,t){var r=_(t),n=!1,l=null;if(!I&&o.metaKeySelection){var a=e.metaKey||e.ctrlKey;r?(l=a?V(t):[z(t)],n=!0):(l=[].concat(y(l=a&&o.value||[]),[z(t)]),n=!0)}else l=r?V(t):[].concat(y(o.value||[]),[z(t)]),n=!0;n&&o.onChange({originalEvent:e,value:l,stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:l}})},K=function(e){T.current&&T.current.scrollToIndex(0);var t=e.value;o.onFilterValueChange?o.onFilterValueChange({originalEvent:e.originalEvent,value:t}):v(t)},k=function(){v(""),o.onFilter&&o.onFilter({filter:""})},G=function(e,t){o.onChange&&o.onChange({originalEvent:e,value:t,stopPropagation:function(){},preventDefault:function(){},target:{name:o.name,id:o.id,value:t}})},V=function(e){return o.value.filter((function(t){return!l.equals(t,z(e),o.dataKey)}))},M=function(){if(null!=o.value&&Z){if(!o.optionGroupLabel)return R(o.value,Z);for(var e=0;e<Z.length;e++){var t=R(o.value,$(Z[e]));if(-1!==t)return{group:e,option:t}}}return-1},B=function(){return o.optionValue?null:o.dataKey},R=function(e,t){var r=B();return t.findIndex((function(t){return l.equals(e,z(t),r)}))},_=function(e){var t=z(e),r=B();return o.multiple&&o.value?o.value.some((function(e){return l.equals(e,t,r)})):l.equals(o.value,t,r)},q=function(e){return o.optionLabel?l.resolveFieldData(e,o.optionLabel):e&&void 0!==e.label?e.label:e},z=function(e){return o.optionValue?l.resolveFieldData(e,o.optionValue):e&&void 0!==e.value?e.value:e},J=function(e){return o.dataKey?l.resolveFieldData(e,o.dataKey):q(e)},X=function(e){return o.optionDisabled?l.isFunction(o.optionDisabled)?o.optionDisabled(e):l.resolveFieldData(e,o.optionDisabled):!(!e||void 0===e.disabled)&&e.disabled},H=function(e){return l.resolveFieldData(e,o.optionGroupLabel)},U=function(e){return l.resolveFieldData(e,o.optionGroupLabel)},$=function(e){return l.resolveFieldData(e,o.optionGroupChildren)},Y=function(){if(T.current){var e=M();-1!==e&&setTimeout((function(){return T.current.scrollToIndex(e)}),0)}};e.useImperativeHandle(u,(function(){return{props:o,getElement:function(){return S.current},getVirtualScroller:function(){return T.current}}})),r((function(){Y()}));var Q=function(t,r){return $(t).map((function(t,n){var l=q(t),a=n+"_"+J(t),i=X(t),u=i?null:o.tabIndex||0;return e.createElement(O,{key:a,label:l,option:t,style:r,template:o.itemTemplate,selected:_(t),onClick:F,onTouchEnd:N,tabIndex:u,disabled:i})}))},W=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={height:n.props?n.props.itemSize:void 0};if(o.optionGroupLabel){var i=o.optionGroupTemplate?l.getJSXElement(o.optionGroupTemplate,t,r):U(t),u=Q(t,a),c=r+"_"+H(t);return e.createElement(e.Fragment,{key:c},e.createElement("li",{className:"p-listbox-item-group",style:a,role:"group"},i),u)}var s=q(t),p=r+"_"+J(t),f=X(t),m=f?null:o.tabIndex||0;return e.createElement(O,{key:p,label:s,option:t,style:a,template:o.itemTemplate,selected:_(t),onClick:F,onTouchEnd:N,tabIndex:m,disabled:f})},Z=function(){if(P){var e=L.trim().toLocaleLowerCase(o.filterLocale),r=o.filterBy?o.filterBy.split(","):[o.optionLabel||"label"];if(o.optionGroupLabel){var n,l=[],a=w(o.options);try{for(a.s();!(n=a.n()).done;){var i=n.value,u=t.filter($(i),r,e,o.filterMatchMode,o.filterLocale);u&&u.length&&l.push(C(C({},i),{items:u}))}}catch(e){a.e(e)}finally{a.f()}return l}return t.filter(o.options,r,e,o.filterMatchMode,o.filterLocale)}return o.options}(),ee=l.isNotEmpty(o.tooltip),te=l.findDiffKeys(o,D.defaultProps),re=a("p-listbox p-component",{"p-disabled":o.disabled},o.className),ne=a("p-listbox-list-wrapper",o.listClassName),le=function(){if(o.virtualScrollerOptions){var t=C(C({},o.virtualScrollerOptions),{items:Z,onLazyLoad:function(e){return o.virtualScrollerOptions.onLazyLoad(C(C({},e),{filter:Z}))},itemTemplate:function(e,t){return e&&W(e,t.index,t)},contentTemplate:function(t){var r=a("p-listbox-list",t.className);return e.createElement("ul",{ref:t.contentRef,className:r,role:"listbox","aria-multiselectable":o.multiple,"aria-labelledby":o["aria-labelledby"],"aria-label":o["aria-label"]},t.children)}});return e.createElement(i,s({ref:T},t))}var r=Z?Z.map(W):null;return e.createElement("ul",{className:"p-listbox-list",role:"listbox","aria-multiselectable":o.multiple,"aria-labelledby":o["aria-labelledby"],"aria-label":o["aria-label"]},r)}(),ae=o.filter?e.createElement(x,{filter:L,onFilter:K,resetFilter:k,filterTemplate:o.filterTemplate,disabled:o.disabled,filterPlaceholder:o.filterPlaceholder,filterInputProps:o.filterInputProps}):null;return e.createElement(e.Fragment,null,e.createElement("div",s({ref:S,id:o.id,className:re,style:o.style},te),ae,e.createElement("div",{className:ne,style:o.listStyle},le)),ee&&e.createElement(n,s({target:S,content:o.tooltip},o.tooltipOptions)))})));D.displayName="ListBox",D.defaultProps={__TYPE:"ListBox",id:null,value:null,options:null,optionLabel:null,optionValue:null,optionDisabled:null,optionGroupLabel:null,optionGroupChildren:null,optionGroupTemplate:null,itemTemplate:null,style:null,listStyle:null,listClassName:null,className:null,virtualScrollerOptions:null,disabled:null,dataKey:null,multiple:!1,metaKeySelection:!1,filter:!1,filterTemplate:null,filterBy:null,filterValue:null,filterMatchMode:"contains",filterPlaceholder:null,filterLocale:void 0,filterInputProps:null,tabIndex:0,tooltip:null,tooltipOptions:null,"aria-label":null,"aria-labelledby":null,onChange:null,onFilterValueChange:null};export{D as ListBox};
